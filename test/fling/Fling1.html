<!DOCTYPE html>
<html lang="en">
<body>

<style>
  fling-ball {
    display: block;
    position: fixed;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background-color: blue;
    border: 4px solid red;
  }
</style>


<fling-ball style="top: 100px; left: 100px;"></fling-ball>

<!--
todo bug We should add text to the fling-ball and find out how we can fling the ball with text.
-->
<fling-ball style="top: 300px; left: 300px;">fling me!</fling-ball>

<script type="module">

  import {FlingEventMixin} from "../../src/FlingEventMixin.js";

  class FlingBall extends FlingEventMixin(HTMLElement) {

    constructor() {
      super();
      this._onDragStartListener = e => this._onDraggingStart(e);
      this._onDraggingListener = e => this._onDragging(e);
      this._onFlingingListener = e => this._onFlinging(e);
    }

    connectedCallback() {
      super.connectedCallback();
      this.addEventListener("draggingstart", this._onDragStartListener);
      this.addEventListener("dragging", this._onDraggingListener);
      this.addEventListener("fling", this._onFlingingListener);
    }

    disconnectedCallback() {
      super.disconnectedCallback();
      this.removeEventListener("draggingstart", this._onDragStartListener);
      this.removeEventListener("dragging", this._onDraggingListener);
      this.removeEventListener("fling", this._onFlingingListener);
    }

    _onDraggingStart(e){
      this.startTime = e.timeStamp;
    }

    _onDragging(e) {
      this.style.transition = undefined;
      this.style.left = (parseFloat(this.style.left) + e.detail.moveX) + "px";
      this.style.top = (parseFloat(this.style.top) + e.detail.moveY) + "px";
    }

    _onFlinging(e) {
      const totalTime = e.timeStamp - this.startTime;
      const addX = e.detail.xSpeedPxMs * totalTime;
      const addY = e.detail.ySpeedPxMs * totalTime;
      this.style.transition = "all " + totalTime + "ms cubic-bezier(0.39, 0.58, 0.57, 1)";
      this.style.left = (parseFloat(this.style.left) + addX) + "px";
      this.style.top = (parseFloat(this.style.top) + addY) + "px";
    }
  }

  customElements.define("fling-ball", FlingBall);
</script>

</body>
</html>